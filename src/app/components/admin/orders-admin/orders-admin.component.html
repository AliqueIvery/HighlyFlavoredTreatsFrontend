<section class="orders-page">
  <!-- Header / actions -->
  <header class="orders-header">
    <div class="title-block">
      <h2>Orders</h2>
      <p>Review incoming orders, shipping type, and update status.</p>
    </div>

    <div class="header-actions">
      <button mat-stroked-button color="primary" (click)="loadOrders()">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
    </div>
  </header>

  <!-- Loading -->
  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- Error -->
  <div class="error-banner" *ngIf="error">
    <mat-icon>error_outline</mat-icon>
    <span>{{ error }}</span>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!loading && !orders.length">
    <mat-icon>inbox</mat-icon>
    <h3>No orders yet</h3>
    <p>Once customers place orders, theyâ€™ll show up here.</p>
  </div>

  <!-- Orders list -->
  <div class="orders-card" *ngIf="orders.length">
    <div class="orders-header-row">
      <div class="col id-col">Order</div>
      <div class="col customer-col">Customer</div>
      <div class="col address-col">Address</div>
      <div class="col shipping-col">Fulfillment</div>
      <div class="col total-col">Total</div>
      <div class="col date-col">Date</div>
      <div class="col status-col">Status</div>
    </div>

    <div
      class="orders-row"
      *ngFor="let o of orders; trackBy: trackById"
      role="button"
      tabindex="0"
      (click)="openOrderSummary(o.id)"
      (keydown.enter)="openOrderSummary(o.id)"
      (keydown.space)="openOrderSummary(o.id)"
    >
      <!-- ID + email -->
      <div class="col id-col">
        <div class="order-id">#{{ o.id }}</div>
        <div class="email">{{ o.customerEmail }}</div>
      </div>

      <!-- Customer -->
      <div class="col customer-col">
        <div class="customer-name">{{ o.customerName }}</div>
      </div>

      <!-- Address -->
      <div class="col address-col">
        <div class="address-line">
          {{ o.addressLine1 }}
        </div>
        <div class="address-line subtle">
          {{ o.city }}, {{ o.state }} {{ o.postalCode }}
        </div>
      </div>

      <!-- Fulfillment / Shipping type -->
      <div class="col shipping-col">
        <div
          class="chip"
          [ngClass]="
            (o.deliveryType || '').toUpperCase() === 'DELIVERY'
              ? 'chip-delivery'
              : 'chip-shipping'
          "
        >
          <mat-icon>
            {{
              (o.deliveryType || '').toUpperCase() === 'DELIVERY'
                ? 'local_shipping'
                : 'local_post_office'
            }}
          </mat-icon>
          <span>
            {{
              (o.deliveryType || '').toUpperCase() === 'DELIVERY'
                ? 'Local Delivery'
                : 'Shipping'
            }}
          </span>
        </div>

        <div class="fulfillment-note" *ngIf="o.deliveryEligible">
          Eligible for local delivery
        </div>
      </div>

      <!-- Total -->
      <div class="col total-col">
        <div class="total-amount">
          {{ formatMoney(o.grandTotalCents) }}
        </div>
      </div>

      <!-- Date -->
      <div class="col date-col">
        <div class="created-at">
          {{ formatDate(o.createdAt) }}
        </div>
      </div>

      <!-- Status -->
      <div class="col status-col "(click)="$event.stopPropagation()">
        <div class="dropdown status-dropdown">
          <button
            class="btn btn-sm btn-outline-secondary dropdown-toggle"
            type="button"
            data-bs-toggle="dropdown"
            data-bs-display="static"
            aria-expanded="false"
            [disabled]="updating.has(o.id)"
          >
            {{ o.status }}
          </button>

          <ul class="dropdown-menu">
            <li *ngFor="let status of statusOptions">
              <button
                class="dropdown-item"
                [class.active]="status === o.status"
                (click)="onStatusChange(o, status)"
              >
                {{ status }}
              </button>
            </li>
          </ul>
        </div>
        <mat-progress-bar
          *ngIf="updating.has(o.id)"
          mode="indeterminate"
          class="row-progress"
        ></mat-progress-bar>
      </div>
    </div>
  </div>
</section>
