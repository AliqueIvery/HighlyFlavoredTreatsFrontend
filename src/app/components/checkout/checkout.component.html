<section class="checkout-page">
  <h2>Checkout</h2>

  <form
    [formGroup]="checkoutForm"
    (ngSubmit)="onSubmit()"
    class="checkout-form"
  >
    <!-- Customer Info -->
    <div class="section-header">
      <h3>Contact Information</h3>
      <p>Weâ€™ll use this to send your order updates.</p>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>First Name</mat-label>
        <input matInput formControlName="firstName" />
        <mat-error *ngIf="submitted && f['firstName'].invalid">
          First name is required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Last Name</mat-label>
        <input matInput formControlName="lastName" />
        <mat-error *ngIf="submitted && f['lastName'].invalid">
          Last name is required
        </mat-error>
      </mat-form-field>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" />
        <mat-error *ngIf="submitted && f['email'].invalid">
          Please enter a valid email
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Phone (optional)</mat-label>
        <input matInput formControlName="phone" />
      </mat-form-field>
    </div>

    <!-- Delivery Type -->
    <div class="section-header">
      <h3>Delivery or Shipping</h3>
      <p>Select how you want to receive your order.</p>
    </div>

    <div class="delivery-toggle">
      <button
        mat-stroked-button
        type="button"
        [color]="deliveryType === 'delivery' ? 'accent' : undefined"
        (click)="changeDeliveryType('delivery')"
      >
        Local Delivery
      </button>
      <button
        mat-stroked-button
        type="button"
        [color]="deliveryType === 'shipping' ? 'accent' : undefined"
        (click)="changeDeliveryType('shipping')"
      >
        Shipping
      </button>
    </div>

    <!-- Address -->
    <div class="section-header">
      <h3>Address</h3>
      <p>Weâ€™ll deliver or ship to this location.</p>
    </div>

    <mat-form-field appearance="outline" class="full">
      <mat-label>Street Address</mat-label>
      <input matInput formControlName="address" />
      <mat-error *ngIf="submitted && f['address'].invalid">
        Address is required
      </mat-error>
    </mat-form-field>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>City</mat-label>
        <input matInput formControlName="city" />
        <mat-error *ngIf="submitted && f['city'].invalid">
          City is required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>State</mat-label>
        <input matInput formControlName="state" />
        <mat-error *ngIf="submitted && f['state'].invalid">
          State is required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Postal Code</mat-label>
        <input matInput formControlName="postalCode" />
        <mat-error *ngIf="submitted && f['postalCode'].invalid">
          Postal code is required
        </mat-error>
      </mat-form-field>
    </div>

    <!-- ðŸ§ Your Order Summary -->
    <div class="section-header">
      <h3>Your Order</h3>
      <p>Review your treats before paying.</p>
    </div>

    <div class="order-items" *ngIf="cart.getItems().length; else emptyCart">
      <div class="order-item" *ngFor="let item of cart.getItems()">
        <div class="thumb">
          <img
            [src]="item.product.imageUrl"
            [alt]="item.product.name"
          />
        </div>
        <div class="details">
          <div class="name">{{ item.product.name }}</div>
          <div class="meta">
            Qty: {{ item.quantity }} Â·
            {{ item.product.price | currency }}
          </div>
        </div>
        <div class="line-total">
          {{ (item.product.price * item.quantity) | currency }}
        </div>
      </div>
    </div>

    <ng-template #emptyCart>
      <p class="empty-cart">
        Your cart is empty. Please add items before checking out.
      </p>
    </ng-template>

    <!-- Payment -->
    <div class="section-header">
      <h3>Payment Details</h3>
      <p>Enter your card information below to complete your order.</p>
    </div>

    <div #cardElement class="card-element"></div>

    <!-- Messages -->
    <div class="message error" *ngIf="error">{{ error }}</div>

    <!-- Summary + Submit -->
    <div class="summary-row">
      <div class="total">
        <span>Order Total:</span>
        <strong>{{ cart.subtotal() | currency }}</strong>
      </div>

      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="loading || !cart.getItems().length"
      >
        {{ loading ? 'Processing...' : 'Place Order & Pay' }}
      </button>
    </div>
  </form>
</section>