<div class="admin-page">
  <section class="card">
    <h2>Edit Product</h2>

    <form [formGroup]="form" (ngSubmit)="submit()" class="product-form">
      <div class="field-row">
        <mat-form-field appearance="outline">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Price (USD)</mat-label>
          <input matInput type="number" step="0.01" formControlName="price" />
        </mat-form-field>
      </div>

      <div class="field-row">
        <mat-form-field appearance="outline">
          <mat-label>Slug</mat-label>
          <input matInput formControlName="slug" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Stock</mat-label>
          <input matInput type="number" formControlName="stock" />
        </mat-form-field>
      </div>

      <!-- Image upload -->
      <div class="upload-row">
        <div class="upload-left">
          <label class="file-label">
            <span>Product Image</span>
            <input type="file" accept="image/*" (change)="onFileSelected($event)" />
          </label>
          <p class="hint">Leave blank to keep the current image.</p>

          <div class="upload-status" *ngIf="selectedFile">
            <p>Selected: {{ selectedFile.name }}</p>
            <mat-progress-bar
              *ngIf="saving && uploadProgress > 0 && uploadProgress < 100"
              mode="determinate"
              [value]="uploadProgress">
            </mat-progress-bar>
          </div>
        </div>

        <div class="preview" *ngIf="imagePreviewUrl">
          <p>Preview</p>
          <img [src]="imagePreviewUrl" alt="Preview" class="preview-img" />
        </div>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description (UI only)</mat-label>
        <textarea matInput rows="2" formControlName="description"></textarea>
      </mat-form-field>

      <div class="actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="saving">
          {{ saving ? 'Saving changes...' : 'Save Changes' }}
        </button>
        <button mat-button type="button" routerLink="/admin/products">
          Cancel
        </button>
        <span class="error" *ngIf="saveError">{{ saveError }}</span>
      </div>
    </form>
  </section>
</div>
